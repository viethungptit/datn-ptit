version: "3.9"

services:
  user-db:
    image: postgres:15-alpine
    container_name: user-db
    environment:
      POSTGRES_USER: user_service
      POSTGRES_PASSWORD: user_pass
      POSTGRES_DB: user_db
    ports:
      - "5433:5432"
    volumes:
      - user_db_data:/var/lib/postgresql/data
    networks:
      - micro_net

  admin-db:
    image: postgres:15-alpine
    container_name: admin-db
    environment:
      POSTGRES_USER: admin_service
      POSTGRES_PASSWORD: admin_pass
      POSTGRES_DB: admin_db
    ports:
      - "5434:5432"
    volumes:
      - admin_db_data:/var/lib/postgresql/data
    networks:
      - micro_net

  recommend-db:
    image: postgres:15-alpine
    container_name: recommend-db
    environment:
      POSTGRES_USER: recommend_service
      POSTGRES_PASSWORD: recommend_pass
      POSTGRES_DB: recommend_db
    ports:
      - "5435:5432"
    volumes:
      - recommend_db_data:/var/lib/postgresql/data
    networks:
      - micro_net

  notification-db:
    image: postgres:15-alpine
    container_name: notification-db
    environment:
      POSTGRES_USER: notify_service
      POSTGRES_PASSWORD: notify_pass
      POSTGRES_DB: notification_db
    ports:
      - "5436:5432"
    volumes:
      - notification_db_data:/var/lib/postgresql/data
    networks:
      - micro_net

  recruit-db:
    image: postgres:15-alpine
    container_name: recruit-db
    environment:
      POSTGRES_USER: recruit_service
      POSTGRES_PASSWORD: recruit_pass
      POSTGRES_DB: recruit_db
    ports:
      - "5437:5432"
    volumes:
      - recruit_db_data:/var/lib/postgresql/data
    networks:
      - micro_net

  # RabbitMQ
  rabbitmq:
    image: rabbitmq:3-management
    container_name: rabbitmq
    ports:
      - "5672:5672"   # broker
      - "15672:15672" # management UI
    networks:
      - micro_net

  # MinIO
  minio:
    image: minio/minio:RELEASE.2025-02-03T21-03-04Z-cpuv1
    container_name: minio
    command: server /data --console-address ":9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    ports:
      - "9000:9000" # API
      - "9001:9001" # Console
    volumes:
      - minio_data:/data
    networks:
      - micro_net

volumes:
  user_db_data:
  admin_db_data:
  recommend_db_data:
  notification_db_data:
  recruit_db_data:
  minio_data:

networks:
  micro_net:
    driver: bridge
